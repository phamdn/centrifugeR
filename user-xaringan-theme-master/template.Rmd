---
title: "Non-Trivial Balance of Centrifuge Rotors"
author: "Duy Nghia Pham"
output:
  xaringan::moon_reader:
    css: [useR, useR-fonts]
    lib_dir: libs
---

<!-- class: chapter-slide -->

<!-- # An essential laboratory device -->

## Centrifuge

- Essential laboratory device for particle fractionation
- Centrifuge safety
    + Centrifuge balance
    
### When a rotor is balanced?

.center[

centers of gravity coincide

```{r, echo=FALSE, fig.show="hold", out.width="40%"}
n = 30
par(cex.main = 2)
pie(
    rep(1, n),
    radius = 1,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black",
    main = "center of gravity of rotor"
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.75,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black"
)

col.code <- rep(0, n)
col.code[c(1,16,12,27)] <- "skyblue"
n = 30
pie(
    rep(1, n),
    radius = 1,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = col.code,
    border = "black",
    main = "center of gravity of 4 tubes"
    
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.75,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "white"
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.01,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black"
)
```
]

---

### Balancing centrifuge: common practices

(Peil and Hauryliuk, 2010)
- Loading tubes in opposite buckets

- How to load 19 tubes?
    + **a blank tube**
.center[

```{r, echo=FALSE, fig.show="hold", out.width="40%"}
n = 30
col.code <- rep(0, n)
col.code[c(1:10, 16:24)] <- "skyblue"
col.code[25] <- "pink"
# par(cex.main = 2)
pie(
    rep(1, n),
    radius = 1,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = col.code,
    border = "black",
    # main = "center of gravity of rotor"
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.75,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black"
)


```
]
---

### Balancing centrifuge: common practices

(Peil and Hauryliuk, 2010)
- Loading tubes in opposite buckets

- How to load 19 tubes?
    + a blank tube
    + **2 rounds**
.center[

```{r, echo=FALSE, fig.show="hold", out.width="40%"}
col.code <- rep(0, n)
col.code[c(1:8, 16:23)] <- "skyblue"
par(cex.main = 2)
pie(
    rep(1, n),
    radius = 1,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = col.code,
    border = "black",
    main = "16 tubes"
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.75,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black"
)

col.code <- rep(0, n)
col.code[c(1,11,21)] <- "skyblue"
par(cex.main = 2)
pie(
    rep(1, n),
    radius = 1,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = col.code,
    border = "black",
    main = "3 remaining tubes"
)
par(new=TRUE)
pie(
    rep(1, n),
    labels = NA,
    radius = 0.75,
    clockwise = TRUE,
    init.angle = 90 + 180 / n,
    col = 0,
    border = "black"
)


```
]
---


### Fundamental principle

For a 𝑛-bucket rotor, balancing 𝑘 identical tubes (0 ≤ 𝑘 ≤ 𝑛) is perfectly possible “if and only
if both 𝑘 and 𝑛 − 𝑘 are expressible as linear combinations of prime factors of 𝑛 with nonnegative coefficients”
(Sivek, 2010).

- Can 19 tubes be loaded in a 30-bucket rotor? 𝑛 = 30 and 𝑘 = 19

- Are 19 and 11 expressible as linear combinations of 2, 3, and 5?

- If yes, how to load 19 tubes?

.center[

$\implies$ **centrifugeR** package

based on linear combinations and random sampling
]

---

### centrifugeR package: a solution

```{r, echo=FALSE, message=FALSE, fig.show="hold", out.width="30%", results = "hide", include = FALSE}
library(centrifugeR)
result <- rotor(30,19)
result$load$visual$`531`
```

.center[

```{r, echo=FALSE, fig.show="hold", out.width="60%"}
result$load$visual$`25`
```
]

---

### centrifugeR package: another solution

.center[

```{r, echo=FALSE, fig.show="hold", out.width="60%"}
result$load$visual$`531`
```
]

---

### centrifugeR package: other 7 solutions!

```{r, echo=FALSE, fig.show="hold", out.width="25%"}
result$load$visual$`54`
result$load$visual$`83`
result$load$visual$`184`
result$load$visual$`213`
result$load$visual$`242`
result$load$visual$`372`
result$load$visual$`401`
```

---

#### References

Peil, Oleg, and Vasili Hauryliuk. 2010. “A New Spin on Spinning Your Samples: Balancing Rotors in a
Non-Trivial Manner.” arXiv Preprint arXiv:1004.3671.

Sivek, Gary. 2010. “On Vanishing Sums of Distinct Roots of Unity.” Integers 10 (3): 365–68.

#### Accessibility

<https://engrxiv.org/preprint/view/828/>

<https://CRAN.R-project.org/package=centrifugeR>

#### Contact

Duy Nghia Pham

University of Rostock, Germany

duy.pham@uni-rostock.de

<!-- ## Creating some plots -->

<!-- We will use the [viridis](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html) package to create some colorblind-friendly plots.  -->
<!-- Let's see how the graph looks like with various color-vision-deficiency [simulations](https://github.com/clauswilke/colorblindr): -->

<!-- ```{r, echo=FALSE, message=FALSE} -->
<!-- library(ggplot2) -->
<!-- library(colorblindr) -->
<!-- library(viridis) -->

<!-- theme_useR <- function(base_size = 28) { -->
<!--   theme_bw(base_size = base_size) +  -->
<!--     theme(legend.margin = margin(), legend.title = element_blank()) -->
<!-- } -->
<!-- ``` -->

<!-- ```{r} -->
<!-- fig <- ggplot(iris, aes(Sepal.Length, fill = Species)) +  -->
<!--   geom_density(alpha = 0.7) + theme_useR() +  -->
<!--   theme(legend.position = c(0.8, 0.9),legend.margin = margin(), -->
<!--         legend.title = element_blank())  -->
<!-- fig_grid <- cvd_grid(fig) -->
<!-- ``` -->

<!-- .center[ -->
<!-- ```{r,echo=FALSE, fig.show="hold", out.width="40%"} -->
<!-- fig -->
<!-- cvd_grid(ggplot(iris, aes(Sepal.Length, fill = Species)) +  -->
<!--   geom_density(alpha = 0.7) + theme_useR(base_size = 18) +  -->
<!--   theme(legend.position = c(0.7, 0.8)) ) -->

<!-- ``` -->
<!-- ] -->

<!-- --- -->

<!-- Let's use a color scale that works better -->


<!-- ```{r} -->
<!-- fig2 <- ggplot(iris, aes(Sepal.Length, fill = Species)) +  -->
<!--   geom_density(alpha = 0.8) + theme_useR() +  -->
<!--   theme(legend.position = c(0.8, 0.9))+  -->
<!--   scale_fill_viridis(discrete = TRUE) -->
<!-- fig_grid2 <- cvd_grid(fig2) -->
<!-- ``` -->


<!-- ```{r,echo=FALSE, fig.show="hold", out.width="48%"} -->
<!-- fig2 -->
<!-- cvd_grid(ggplot(iris, aes(Sepal.Length, fill = Species)) +  -->
<!--   geom_density(alpha = 0.8) + theme_useR(base_size = 18) +  -->
<!--   theme(legend.position = c(0.7, 0.8))+ scale_fill_viridis(discrete = TRUE) )  -->
<!-- ``` -->

<!-- --- -->

<!-- ## Do not forget to include alt-text to your figures! -->

<!-- Knitr (version >= 1.31) have a new feature to add alt-text to your figures. Just add fig.alt = "Your alt-text” in the chunk options. -->

<!-- ```{r,echo=FALSE, fig.show="hold", out.width="40%", fig.alt="Two ggplot panels, comparing default ggplot2 colors versus the ggplot2 result using viridis color palette. Each panel shows three superposed color-filled histograms. The default scale uses the colors salmon, light green and light blue, but viridis scale uses purple, aquamarine and yellow, which gives a better contrast."} -->
<!-- fig -->
<!-- fig2 -->
<!-- ``` -->


